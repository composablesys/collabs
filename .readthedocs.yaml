version: 2

build:
  os: "ubuntu-20.04"
  tools:
    # Make sure to keep the python version in sync between here and
    # .circleci/config.yml's docker image version.
    python: "3.10"
    nodejs: "16"
  jobs:
    post_install:
      - npm ci
    pre_build:
      # Regular-build just the packages that have Typedocs.
      # This is necessary because some packages import others, hence
      # Typedoc expects the depenendency to be built, and some packages's
      # Typedocs reference files generated by protobuf during the build.
      - npm run buildForTypedoc
      # Build the Typedocs.
      - npm run build:typedoc -w docs

sphinx:
  configuration: docs/src/conf.py

python:
  install:
    - requirements: docs/requirements.txt
